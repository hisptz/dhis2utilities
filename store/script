"<script>\n    if (dhis2.dsr){\n        function calculateReportIndicators() {\n            $('input[name=\"indicatorFormula\"]').css('border','none'); $('input[name=\"indicatorFormula\"]').css('background-color','#FFFFFF'); $('input[name=\"indicatorFormula\"]').css('font-weight','500');\n            $('input[name=\"indicatorFormula\"]').css('height','2em');\n            $('input[name =\"indicatorFormula\"]').each(function (i, form) {\n                var unReplacedFormula = $(this).attr('indicatorFormula');\n                var elementComboArr = unReplacedFormula.replace(\"/\",\",\").split(\"(\").join(\"\").split(\")\").join(\"\").split(\",\")[0].split(\"+\");\n                var sum = 0;\n                for (var count = 0; count < elementComboArr.length; count++) {\n                    if (elementComboArr[count].length > 18) {\n                        var toReplace='';\n                        var elementCombo = elementComboArr[count].split(\".\");\n                        // console.log('($(\"span[data-co='+elementCombo[1].replace(\"}\",\"\")+'][data-de='+elementCombo[0].replace(\"#{\",\"\")+']\").text())');\n                        var spanValue = parseInt($(\"span[data-co=\"+elementCombo[1].replace(\"}\",\"\")+\"][data-de=\"+elementCombo[0].replace(\"#{\",\"\")+\"]\").text());\n                        if (isNaN(spanValue)=== false) {\n                            sum = spanValue;\n                        } else {\n                            sum = 0;\n                        }\n                        toReplace += elementCombo[0]+'.'+elementCombo[1];\n                        unReplacedFormula = unReplacedFormula.replace(toReplace, sum);\n                    }\n                }\n                console.log(unReplacedFormula);\n                if (parseInt(eval(unReplacedFormula))){\n                    $('#'+form.id).val(parseInt(eval(unReplacedFormula)));\n                }\n            });\n        }\n        $(document).ready(function(){\n            calculateReportIndicators();\n        });\n    }else {\n        dhis2.util.on('dhis2.de.event.dataValuesLoaded', function () {\n            $('input[name=\"indicatorFormula\"]').css('background-color','#EEEEEE'); $('input[name=\"indicatorFormula\"]').css('font-weight','500');\n            $('input[name=\"indicatorFormula\"]').css('height','2em');\n            $('input[name=\"indicatorFormula\"]').css('border','1px grey solid'); $('input[name=\"indicatorFormula\"]').css('text-align','center');\n            calculateIndicatorValue();\n            addListerners();\n        });\n\n        function addListerners(){\n            $('input[name =\"entryfield\"]').each(function (i) {\n                $(this).change(function () {\n                    //codes for on changes\n                    calculateIndicatorValue();\n                });\n            });\n        }\n\n        function validateData(formula) {\n            var valuesToSum = [];\n            formula.split('/')[0].substring(1, formula.split('/')[0].length -1).split('+').forEach(function (value) {\n                if (isNaN(eval(value)) === true) {\n                    // no value\n                } else {\n                    valuesToSum.push(eval(value));\n                }\n            });\n            var theSum = 0;\n            valuesToSum.forEach(function (value) {\n                theSum += value;\n            });\n\n            return theSum;\n        }\n\n        function calculateIndicatorValue() {\n            $('input[name =\"indicatorFormula\"]').each( function (i, form) {\n                var unReplacedFormula = $(this).attr('indicatorFormula');\n                var newFormula = unReplacedFormula;\n                unReplacedFormula.split(\"/\").forEach(function(entryStr){\n                    if (entryStr.length > 18 && entryStr.length < 30 ) {\n                        if (entryStr.indexOf(\"*\") > 1) {\n                            newFormula = newFormula.replace(entryStr.split(\"*\")[0].split(\"(\").join(\"\").split(\")\").join(\"\"), 'Number($(\"#'+entryStr.split(\"*\")[0].split(\"(\").join(\"\").split(\")\").join(\"\").split(\"#{\").join(\"\").split(\"}\").join(\"\").replace(\".\",\"-\")+'-val\").val())');\n                        } else {\n                            newFormula = newFormula.replace(entryStr.split(\"(\").join(\"\").split(\")\").join(\"\"),'Number($(\"#'+entryStr.split(\"(\").join(\"\").split(\")\").join(\"\").split(\"#{\").join(\"\").split(\"}\").join(\"\").replace(\".\",\"-\")+'-val\").val())');\n                        }\n                    } else if(entryStr.length > 30) {\n                        entryStr.split(\"+\").forEach(function(entryStr2){\n                            if (entryStr2.indexOf(\"*\") > 1) {\n                                newFormula = newFormula.replace(entryStr2.split(\"*\")[0].split(\"(\").join(\"\").split(\")\").join(\"\"), 'Number($(\"#'+entryStr2.split(\"*\")[0].split(\"(\").join(\"\").split(\")\").join(\"\").split(\"#{\").join(\"\").split(\"}\").join(\"\").replace(\".\",\"-\")+'-val\").val())');\n                            } else {\n                                newFormula = newFormula.replace(entryStr2.split(\"(\").join(\"\").split(\")\").join(\"\"),'Number($(\"#'+entryStr2.split(\"(\").join(\"\").split(\")\").join(\"\").split(\"#{\").join(\"\").split(\"}\").join(\"\").replace(\".\",\"-\")+'-val\").val())');\n                            }\n                        })\n                    }\n                });\n\n                if (newFormula !== undefined) {\n                    // validate\n                    var theNewFormula = newFormula.split(\"# \").join(\"#\").split(\" -\").join(\"-\").replace(\"  \",\"\").replace(/(?:\\r\\n|\\r|\\n)/g, '');\n                    $('#'+form.id).val(parseInt(validateData(theNewFormula)));\n                }\n            });\n        }\n    }\n</script>"